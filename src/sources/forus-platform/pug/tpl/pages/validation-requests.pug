.app.app-container
    menu
    section.app.app-content
        .card-heading: .row
            .col.col-sm-6.col-xs-12(
                translate="validation_requests.labels.requests" 
                translate-values="{count: $ctrl.validatorRequestsByBsn.length}")
            .block.block-inline-filters.col.col-sm-6.col-xs-12
                .button.button-text(ng-if="$ctrl.filters.show" ng-click="$ctrl.resetFilters()")
                    em.mdi.mdi-close
                    span(i18n="Wis filters")

                .form(ng-show="!$ctrl.filters.show")
                    .form-group.inline-filters-search: input(
                        ng-model="$ctrl.filters.values.q" 
                        type="text" 
                        placeholder="{{ 'search' | i18n }}").form-control

                .inline-filters-dropdown(click-outside="$ctrl.hideFilters()")
                    .inline-filters-dropdown-content(ng-show="$ctrl.filters.show")
                        .arrow-box.bg-dim: .arrow
                        .form
                            .form-group
                                form-label-toggle(label="{{ 'search' | i18n }}" is-active)
                                input(ng-model="$ctrl.filters.values.q" type="text" placeholder="{{ 'search' | i18n }}").form-control
                            .form-group
                                form-label-toggle(label="{{ 'organization_providers.state' | i18n }}")
                                select(
                                    ng-options="state.key as state.name for state in $ctrl.states"
                                    ng-model="$ctrl.filters.values.state").form-control

                    .button.button-default.button-icon(ng-click="$ctrl.filters.show = !$ctrl.filters.show"): em.mdi.mdi-filter-outline

        .card.card-collapsable(
            ng-repeat="validatorRequest in $ctrl.validatorRequestsByBsn")
            .card-section(ng-click="validatorRequest.collapsed = !validatorRequest.collapsed")
                .card-section-actions(ng-show="validatorRequest.nth.pending > 0")
                    .tag.tag-warning(translate="validation_requests.status.hold")
                .card-title
                    span(ng-bind="'BSN: ' + validatorRequest.bsn")
                    .card-collapse.mdi(ng-class="'mdi-chevron-' + (validatorRequest.collapsed ? 'down' : 'up')")

            mixin keyvalue_item_horizontal(key, value)
                .keyvalue-item.col.col-sm-3
                    .keyvalue-key=key
                    .keyvalue-value=value

            .card-section.card-section-primary(ng-click="validatorRequest.collapsed = !validatorRequest.collapsed")
                .card-block.card-block-keyvalue.card-block-keyvalue-horizontal: .row
                    +keyvalue_item_horizontal("Gevalideerd", "{{ validatorRequest.nth.approved }}")
                    +keyvalue_item_horizontal("Niet gevalideerd", "{{ validatorRequest.nth.declined }}")
                    +keyvalue_item_horizontal("Openstaande validaties", "{{ validatorRequest.nth.pending }}")
            
            .card-section.card-section-primary.text-center(ng-if="!validatorRequest.collapsed")
                button.button.button-primary(
                    ng-click="$ctrl.shownUsers[validatorRequest.bsn] = !$ctrl.shownUsers[validatorRequest.bsn]")
                    em.mdi.mdi-format-list-bulleted 
                    | {{ "validation_requests.buttons.show" | translate }}
            
            .card-header(ng-show="$ctrl.shownUsers[validatorRequest.bsn] && !validatorRequest.collapsed")
                .arrow-box.border.bg-dim: .arrow
                .card-title 
                    .row 
                        .col.col-sm-6(translate="validation_requests.labels.records")
                        .col.col-sm-6.text-right
                            button(ng-click="$ctrl.validateAll(validatorRequest)").button.button-primary
                                em.mdi.mdi-check-circle
                                | {{ "validation_requests.buttons.allaccept" | translate }}
                            button(ng-click="$ctrl.declineAll(validatorRequest)").button.button-default
                                em.mdi.mdi-close
                                | {{ "validation_requests.buttons.alldecline" | translate }}
            .card-section(ng-show="$ctrl.shownUsers[validatorRequest.bsn] && !validatorRequest.collapsed")
                .card-block.card-block-table: .table-wrapper: table.table
                    tr
                        th(translate="validation_requests.labels.type")
                        th(translate="validation_requests.labels.value")
                        th(translate="validation_requests.labels.date")
                        th(translate="validation_requests.labels.status")
                        th(translate="validation_requests.labels.actions").text-right
                    tr(ng-repeat="request in validatorRequest.requests")
                        td: a(ui-sref="validation-request(request)" ng-bind="request.record.name").text-primary
                        td(ng-bind="request.record.value")
                        td(ng-bind="request.created_at")
                        td.text-right: .tag(
                            ng-class="{pending: 'tag-warning', declined: 'tag-danger', approved: 'tag-success'}[request.state]"
                            translate="validation_requests.status.{{ request.state }}")
                        td.text-right
                            .button.button-primary.button-icon(
                                ng-if="request.state == 'pending'"
                                ng-click="$ctrl.validateRequest(request, true)"): em.mdi.mdi-check
                            .button.button-default.button-icon(
                                ng-if="request.state == 'pending'"
                                ng-click="$ctrl.declineRequest(request, true)"): em.mdi.mdi-close
                                    
            .card-section(ng-show="$ctrl.shownUsers[validatorRequest.bsn] && !validatorRequest.collapsed")
                .table-pagination
                    .table-pagination-counter(
                        translate="validation_requests.labels.results"
                        translate-values="{count: validatorRequest.requests.length}")
                    //-  .table-pagination-navigation
                        button(disabled).button.button-default Prev
                        button.button.button-default 1
                        button.button.button-default 2
                        button.button.button-primary 3
                        button(disabled).button.button-default Next
        .card: .card-section(ng-show="$ctrl.validatorRequests.meta.last_page > 1"): paginator(
            meta="$ctrl.validatorRequests.meta" 
            filters="$ctrl.filters.values" 
            count-buttons="5" 
            on-page-change="$ctrl.onPageChange(query)")